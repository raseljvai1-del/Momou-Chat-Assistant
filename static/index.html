<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chat With our AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-50 min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-lg overflow-hidden">
      <header class="px-6 py-4 border-b">
        <div class="flex items-center gap-4">
          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-pink-500 flex items-center justify-center text-white font-semibold">AI</div>
          <div>
            <h1 class="text-lg font-semibold">Momou AI Assistant</h1>
          </div>
        </div>
      </header>

      <main class="p-6">
        <div id="messages" class="space-y-4 max-h-[60vh] overflow-auto pb-4">
          <!-- messages will be appended here -->
        </div>

        <form id="chat-form" class="mt-4 flex gap-2">
          <input id="message-input" aria-label="Type a message" autocomplete="off" type="text" placeholder="Ask the AI something..." class="flex-1 px-4 py-3 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-300" />
          <button id="send-btn" class="px-4 py-3 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700">Send</button>
        </form>

        <div class="mt-3 flex items-center justify-between text-sm text-slate-500">
          <div>Tip: press <kbd class="border rounded px-2 py-0.5 bg-slate-100">Enter</kbd> to send.</div>
          <button id="clear-btn" class="text-xs text-slate-600 hover:underline">Clear chat</button>
        </div>
      </main>

      <footer class="px-6 py-4 border-t text-xs text-slate-500">
        © 2025 Momou. All rights reserved.
      </footer>
    </div>

    <script>
      const baseUrl = '';

      const messageInput = document.getElementById('message-input');
      const messagesEl = document.getElementById('messages');
      const chatForm = document.getElementById('chat-form');
      const sendBtn = document.getElementById('send-btn');
      const clearBtn = document.getElementById('clear-btn');

      function appendMessage(from, text) {
        const wrapper = document.createElement('div');
        wrapper.className = from === 'user' ? 'flex justify-end' : 'flex justify-start';

        const bubble = document.createElement('div');
        bubble.className = (from === 'user' ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-800') + ' max-w-[80%] p-3 rounded-lg shadow-sm';
        bubble.innerText = text;

        wrapper.appendChild(bubble);
        messagesEl.appendChild(wrapper);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      function setLoading(loading) {
        sendBtn.disabled = loading;
        sendBtn.innerText = loading ? 'Sending...' : 'Send';
        messageInput.disabled = loading;
      }

      async function sendMessage(message) {
        appendMessage('user', message);
        setLoading(true);
        try {
          const res = await fetch((baseUrl || '') + '/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
          });

          if (!res.ok) {
            const text = await res.text();
            appendMessage('assistant', `Error: ${res.status} ${text}`);
            return;
          }

          const data = await res.json();

          // Expecting returned shape
          const reply = data.reply ?? data.message ?? JSON.stringify(data);
          appendMessage('assistant', reply);
        } catch (err) {
          appendMessage('assistant', 'Network error — could not reach the API.');
          console.error(err);
        } finally {
          setLoading(false);
        }
      }

      chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const txt = messageInput.value.trim();
        if (!txt) return;
        sendMessage(txt);
        messageInput.value = '';
        messageInput.focus();
      });

      // Send on Enter (when not holding Shift)
      messageInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          chatForm.requestSubmit();
        }
      });

      clearBtn.addEventListener('click', () => {
        messagesEl.innerHTML = '';
        messageInput.focus();
      });

      // Small demo message
      appendMessage('assistant', 'Hello! Ask your query here AI assistance will relay your message.');
    </script>
  </body>
</html>
